
blueprint:
  name: Koszenie trawnika - elastyczne okno z powiadomieniem
  description: >
    Uruchamia kosiarkę w określonym oknie czasowym, jeśli nie pada i prognozowane opady są poniżej progu.
    Wysyła powiadomienie na urządzenie mobilne (mobile_app) po uruchomieniu koszenia.
  domain: automation
  input:
    mower_entity:
      name: Encja kosiarki
      selector:
        entity:
          domain: lawn_mower
    rain_sensor:
      name: Czujnik deszczu (binary_sensor)
      selector:
        entity:
          domain: binary_sensor
    rain_forecast_sensor:
      name: Sensor prognozowanych opadów (mm)
      selector:
        entity:
          domain: sensor
    rain_threshold:
      name: Próg opadów (mm)
      default: 4
      selector:
        number:
          min: 0
          max: 20
          step: 0.1
          unit_of_measurement: mm
    mowing_start:
      name: Początek okna koszenia
      selector:
        time: {}
    mowing_end:
      name: Koniec okna koszenia
      selector:
        time: {}
    notify_device:
      name: Urządzenie mobilne (mobile_app)
      selector:
        device:
          integration: mobile_app

trigger:
  - platform: time_pattern
    minutes: "/5"

condition:
  - condition: time
    after: !input mowing_start
    before: !input mowing_end
  - condition: state
    entity_id: !input rain_sensor
    state: "off"
  - condition: numeric_state
    entity_id: !input rain_forecast_sensor
    below: !input rain_threshold
  - condition: state
    entity_id: !input mower_entity
    state: "docked"

action:
  - service: lawn_mower.start_mowing
    target:
      entity_id: !input mower_entity
  - alias: Powiadomienie o rozpoczęciu koszenia
    domain: mobile_app
    type: notify
    device_id: !input notify_device
    message: "Heniek rozpoczął koszenie w elastycznym oknie czasowym."

mode: single
