blueprint:
  name: Koszenie trawnika - elastyczne okno z powiadomieniem
  description: >
    Uruchamia kosiarkę w określonym oknie czasowym, jeśli nie pada i prognozowane opady są poniżej progu.
    Wysyła powiadomienie na wybrane urządzenie mobilne (mobile_app).
  domain: automation
  input:
    mower_entity:
      name: Kosiarka
      description: Encja kosiarki (np. lawn_mower.heniek)
      selector:
        entity:
          domain: lawn_mower

    rain_sensor:
      name: Czujnik deszczu
      description: Binary sensor wykrywający deszcz (np. binary_sensor.heniek_rainsensor_triggered)
      selector:
        entity:
          domain: binary_sensor

    rain_forecast_sensor:
      name: Sensor prognozowanych opadów
      description: Sensor z prognozowaną sumą opadów (np. sensor.opady_dzisiaj)
      selector:
        entity:
          domain: sensor

    rain_threshold:
      name: Próg opadów (mm)
      description: Maksymalna prognozowana suma opadów, przy której można kosić
      default: 4
      selector:
        number:
          min: 0
          max: 20
          unit_of_measurement: mm
          mode: slider
          step: 0.1

    mowing_start:
      name: Początek okna koszenia
      selector:
        time:

    mowing_end:
      name: Koniec okna koszenia
      selector:
        time:

    notify_device:
      name: Urządzenie mobilne do powiadomień
      selector:
        device:
          integration: mobile_app

trigger:
  - platform: time_pattern
    minutes: "/5"

condition:
  - condition: time
    after: !input mowing_start
    before: !input mowing_end
  - condition: state
    entity_id: !input rain_sensor
    state: "off"
  - condition: numeric_state
    entity_id: !input rain_forecast_sensor
    below: !input rain_threshold
  - condition: state
    entity_id: !input mower_entity
    state: "docked"

action:
  - service: lawn_mower.start_mowing
    target:
      entity_id: !input mower_entity
  - domain: mobile_app
    type: notify
    device_id: !input notify_device
    title: "Koszenie rozpoczęte"
    message: "Heniek rozpoczął koszenie w elastycznym oknie czasowym."
mode: single
